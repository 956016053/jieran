<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI çŸ¥è¯†å›¾é‰´ (@å­‘ç‡ƒ)</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/app.css?v=28.0">
    
    <script src="https://cdn.jsdelivr.net/npm/tsparticles-slim@2.0.6/tsparticles.slim.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>

    <style>
        .view-section { display: none; animation: fadeIn 0.5s; }
        .view-section.active { display: block; }
        .tab-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 30px; width: fit-content; margin-left: auto; margin-right: auto; }
        .tab-btn { background: transparent; border: 2px solid transparent; color: #aaa; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-size: 1rem; transition: all 0.3s; font-family: "Microsoft YaHei", sans-serif; }
        .tab-btn.active { background: rgba(255,255,255,0.1); color: #fff; border-color: #00d2ff; box-shadow: 0 0 10px rgba(0, 210, 255, 0.3); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="tsparticles"></div>
    <div id="gestureActionOverlay" class="gesture-feedback-overlay">ğŸ‘‹</div>
	<!-- æˆ˜æ–—é¢æ¿ -->
	<div id="virusBoss" class="virus-container" style="display:none;">
	        <div class="virus-glitch-wrapper">
	                    <i class="fas fa-spider virus-icon"></i>
	                </div>
	        <div class="virus-glitch"></div>
	    </div>
	
	    <div id="battlePanel" style="display:none; position:fixed; top:120px; left:50%; transform:translateX(-50%); width:90%; max-width:500px; z-index:9999; pointer-events:none; background:rgba(0,0,0,0.6); padding:15px; border-radius:15px; border:1px solid rgba(255, 0, 85, 0.3); backdrop-filter: blur(5px);">
	        
	        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
	            <span style="color:#ff0055; font-weight:bold; text-shadow:0 0 10px #ff0055;">ğŸ‘¾ \u7f51\u7edc\u75c5\u6bd2 (BOSS)</span>
	            <span id="enemyHpText" style="color:#fff;">100%</span>
	        </div>
	        <div style="width:100%; height:12px; background:#333; border-radius:10px; overflow:hidden; border:1px solid #555;">
	            <div id="enemyHpBar" style="width:100%; height:100%; background:linear-gradient(90deg, #ff0055, #ff6b6b); transition:width 0.3s cubic-bezier(0.4, 0, 0.2, 1);"></div>
	        </div>
	
	        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px; margin-bottom:5px;">
	            <span style="color:#00f2fe; font-weight:bold; text-shadow:0 0 10px #00f2fe;">ğŸ›¡ï¸ \u672c\u5730\u9632\u706b\u5899 (YOU)</span>
	            <span id="playerHpText" style="color:#fff;">100%</span>
	        </div>
	        <div style="width:100%; height:12px; background:#333; border-radius:10px; overflow:hidden; border:1px solid #555;">
	            <div id="playerHpBar" style="width:100%; height:100%; background:linear-gradient(90deg, #00f2fe, #4facfe); transition:width 0.3s cubic-bezier(0.4, 0, 0.2, 1);"></div>
	        </div>
	        
	        <div id="battleWarning" style="text-align:center; color:#ff3333; font-weight:bold; margin-top:8px; opacity:0; font-size:0.9rem; text-shadow: 0 0 5px red;">âš ï¸ \u8b66\u544a\uff1a\u9632\u706b\u5899\u5373\u5c06\u5d29\u6e83...</div>
	    </div>

    <div id="draggableCamera">
        <div style="padding: 10px; text-align:center;">
            <button id="camBtn" class="btn-cam" onclick="window.gestureSystem.toggleCamera()">
                <i class="fas fa-camera"></i> å¼€å¯æ‰‹åŠ¿
            </button>
            <div id="videoContainer" class="video-overlay" style="margin-top:10px; display:none;">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="output_canvas"></canvas>
                <div id="gestureFeedback" class="gesture-hint">ç­‰å¾…æ‰‹åŠ¿...</div>
            </div>
        </div>
    </div>

    <div class="donate-fab-container">
        <div class="donate-card">
            <div class="donate-title">â˜• æŠ•å–‚å¼€å‘è€…</div>
            <div class="qr-codes" style="display: flex; gap: 10px; justify-content: space-around;">
                <div class="qr-item">
                    <img src="/img/qr-wechat.jpg" alt="å¾®ä¿¡" style="width:100px; height:100px; background:#fff; padding:5px; border-radius:5px;">
                    <div style="font-size:0.8rem; margin-top:5px; color:#ccc;">å¾®ä¿¡æ”¯ä»˜</div>
                </div>
                <div class="qr-item">
                    <img src="images/alipay.png" alt="æ”¯ä»˜å®" style="width:100px; height:100px; background:#fff; padding:5px; border-radius:5px;">
                    <div style="font-size:0.8rem; margin-top:5px; color:#ccc;">æ”¯ä»˜å®</div>
                </div>
            </div>
        </div>
        <button class="donate-fab"><i class="fas fa-gift"></i></button>
    </div>

    <header>
        <div style="flex:1;">
            <h2 style="margin:0;font-size:1.2rem;">AI çŸ¥è¯†å›¾é‰´ - æŠ½å¡æ¨¡å¼</h2>
            <div class="xp-bar-bg"><div class="xp-bar-fill" id="xpBar"></div></div>
            <div class="stats-text">
                XP: <span id="scoreVal">0</span> | å·²æŒæ¡: <span id="masteredCount">0</span>
            </div>
        </div>
    </header>

    <div class="tab-container">
            <button class="tab-btn active" onclick="switchView('gacha')">ğŸ° çŸ¥è¯†æŠ½å¡</button>
            <button class="tab-btn" onclick="switchView('factory')">ğŸ­ é¢˜åº“å·¥å‚</button>
            <button class="tab-btn" onclick="window.location.href='quiz.html?subject=default'" style="border-color: #4facfe; color: #4facfe;">
                ğŸ”® è¿›å…¥MLé¢˜åº“
            </button>
        </div>

    <div id="view-gacha" class="view-section active">
        <div style="text-align:center; margin-bottom:30px;">
            <button onclick="window.gachaSystem.draw(1)" class="btn-draw blue-btn"><i class="fas fa-bolt"></i> å•æŠ½</button>
            <button onclick="window.gachaSystem.draw(5)" class="btn-draw purple-btn"><i class="fas fa-layer-group"></i> äº”è¿æŠ½</button>
            <button onclick="window.gachaSystem.draw(10)" class="btn-draw gold-btn"><i class="fas fa-gem"></i> åè¿æŠ½</button>
            <button onclick="window.gachaSystem.openAlbum()" class="btn-draw ghost-btn"><i class="fas fa-book"></i> æˆ‘çš„å¡å†Œ</button>
			<button onclick="window.gachaSystem.toggleBattleMode()" class="btn-draw" style="background:linear-gradient(135deg, #ff0055, #7928ca); box-shadow: 0 0 15px #ff0055;">
			    âš”ï¸ å¼€å¯ç”Ÿå­˜æŒ‘æˆ˜
			</button>
        </div>

        <div id="cardContainer" class="card-grid"></div>
        
        
    </div>

    <div id="view-factory" class="view-section">
        <div style="background: rgba(30, 43, 74, 0.9); padding: 25px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); max-width: 800px; margin: 0 auto;">
            <h3 style="margin-top:0; color:#4facfe;">ğŸ­ ä¸Šä¼  PDF -> AI æ™ºèƒ½å‡ºé¢˜</h3>
            <div style="margin-bottom: 15px;">
                <label style="color:#aaa; font-size:0.9rem;">ğŸ”‘ DeepSeek API Key:</label>
                <input type="password" id="apiKeyInput" placeholder="sk-..." style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #555; background: #222; color: #fff; margin-top:5px;">
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                <input type="file" id="pdfUpload" accept="application/pdf" style="color:#fff;">
                <button onclick="window.localGen.startProcess()" class="btn-draw purple-btn">âš¡ å¼€å§‹ç”Ÿæˆ</button>
                <button onclick="window.localGen.clearData()" class="btn-draw ghost-btn" style="color:#e74c3c;">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            <div style="margin-top: 25px;">
                <div id="genStatus" style="font-size: 0.9rem; color: #aaa;">ç­‰å¾…ä¸Šä¼ ...</div>
                <div id="progressContainer" style="width: 100%; background-color: #333; border-radius: 10px; margin: 15px 0; overflow: hidden; display: none; height: 10px;">
                    <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #00d2ff, #3a7bd5); transition: width 0.3s ease;"></div>
                </div>
            </div>
            <div style="margin-top: 20px; padding-top:15px; border-top:1px dashed #444; display:flex; justify-content:space-between; align-items:center;">
                <div style="font-size: 0.9rem; color: #fff;">
                    æœ¬åœ°åº“å­˜: <span id="localCount" style="color:#00d2ff; font-weight:bold; font-size:1.4rem;">0</span> é¢˜
                </div>
                <button id="startLocalQuizBtn" onclick="window.location.href='quiz.html?subject=local'" class="btn-draw" style="display:none; background: linear-gradient(45deg, #2ecc71, #1abc9c);">
                    ğŸš€ å»ç­”é¢˜
                </button>
            </div>
        </div>
    </div>

    <div id="albumModal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999;">
        <div class="modal-content" style="background:#1a1a2e; margin: 5% auto; padding:30px; width:90vw; max-width:1400px; border-radius:20px; border:2px solid #4facfe; box-shadow: 0 0 30px rgba(79, 172, 254, 0.4); max-height:85vh; overflow-y:auto;">
            <h3 style="color:#fff; margin-top:0; text-align:center; font-size:1.5rem;">ğŸ“š çŸ¥è¯†å›¾é‰´å…¨é›†</h3>
            <div id="albumGrid"></div>
            <button onclick="document.getElementById('albumModal').style.display='none'" class="btn-draw ghost-btn" style="margin-top:30px; width:100%; height:50px; font-size:1.1rem;">å…³é—­å›¾é‰´</button>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/local-generator.js"></script> 
    <script type="module" src="js/gesture.js"></script>
    <script type="module" src="js/app.js"></script>
    <script src="js/loader.js"></script>
    <script>
        function switchView(v) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            const btns = document.querySelectorAll('.tab-btn');
            if(v === 'gacha') btns[0].classList.add('active'); else btns[1].classList.add('active');
        }
    </script>
</body>
</html>